<html>
<head>
  <title>JD-asm</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="JD-asm">
  <link rel="apple-touch-icon" href="https://repository-images.githubusercontent.com/24021024/5e678080-0cfe-11eb-9edf-294da025f0c1">
  <meta property="og:image" content="https://repository-images.githubusercontent.com/24021024/5e678080-0cfe-11eb-9edf-294da025f0c1" />
  <style>#r1 div, #r2 div { border-style:solid; border-color:black; border-width:2px; }</style>
</head>
<body onload="init();">
<script type="text/javascript" src="swingIO/UI.js"></script>
<script type="text/javascript" src="RandomAccessFileV/FileReaderV.js"></script>
<script type="text/javascript" id="Format"></script>
<script type="text/javascript" id="coreType"></script>
<script>
  /*------------------------------------------------------------
  This is a web based version of JDisassembly originally designed to run in Java.
  See https://github.com/Recoskie/JDisassembly/blob/master/app.java
  ------------------------------------------------------------*/
  
  var file = new FileReaderV(), r = null, r1 = null, r2 = null;
  var Tree = null, dModel = null, info = null;
  var offset = null, virtual = null, ds = null;

  //The currently loaded format reader.

  var Format = null;

  //Used for loading in processor core types.

  var coreType = null;

  //Enable binary tree and data model, and info window for file format readers.

  var formatLoad = false;

  //It is important that the GUI components do not validate till everything completes.

  var loadingDone = false;

  //Use the file signature codes instead of file extension.

  var signature =
  [
    [ 0x4D, 0x5A ], //Microsoft binaries.
    [ 0x7F, 0x45, 0x4C, 0x46 ], //Linux/UNIX binaries.
    [ 0xCE, 0xFA, 0xED, 0xFE ], //32 Bit Mac/IOS binary.
    [ 0xCF, 0xFA, 0xED, 0xFE ], //64 Bit Mac/IOS binary.
    [ 0xCA, 0xFE, 0xBA, 0xBE ], //Mac/IOS universal binary.
    /*[ 0xCA, 0xFE, 0xBA, 0xBE ],*/ //Reserved for java class loader format plugin.
    [ 0x42, 0x4D ], //Bit map pictures.
    [ 0xFF, 0xD8 ], //JPEG start of image marker.
    [ 0x52, 0x49, 0x46, 0x46 ], //Multimedia RIFF file.
    [ 0x52, 0x46, 0x36, 0x34 ], //Multimedia RIFF/64 file.
    [ 0x50, 0x4B, 0x03, 0x04 ], //Compressed ZIP files.
    [ 0x50, 0x4B, 0x07, 0x08 ], //Compressed ZIP files (split).
    [ 0x50, 0x4B, 0x05, 0x06 ] //Compressed ZIP files (Empty).
  ];

  //The file to load. To begin decoding file types.

  var decodeAPP =
  [
    "Format/exe.js", "Format/elf.js", "Format/mac.js", "Format/mac.js", "Format/mac.js", /*"Format/java.js",*/
    "Format/bmp.js", "Format/jpeg.js", "Format/riff.js", "Format/riff.js",
    "Format/zip.js", "Format/zip.js", "Format/zip.js"
  ];

  //Format to load that only use file extension for file type.

  var extensions = [".com"];

  //What file to load for file extension.

  var decodeAppEX = ["Format/com.js"];

  //Initialize the application.
  
  function init()
  {
    r = document.getElementById("r").style; r1 = document.getElementById("r1").style; r2 = document.getElementById("r2").style;

    offset = new VHex("vhex1", file, false); virtual = new VHex("vhex2", file, true);
    ds = new dataInspector("data", file); ds.addEditor(offset); ds.addEditor(virtual);

    Tree = new tree("tree"); dModel = new dataDescriptor("dModel", file); dModel.setInspector(ds); info = document.getElementById("info");

    info.style.overflow = "auto"; info.innerHTML = "File format Information is displayed here, and machine code disassembly.";
    
    virtual.adjSize(); virtual.hide(true); re(); offset.hide(true); ds.hide(true);

    Format = document.getElementById("Format"); coreType = document.getElementById("coreType");
    
    //Open an example file.
    
    file.getFile("https://raw.githubusercontent.com/microsoft/MS-DOS/master/v2.0/bin/DEBUG.COM", load);
  }
  
  //Layout change based on window dimensions, or orientation.
    
  var vertical = null, mobile = !isNaN( window.orientation );
  
  if( mobile )
  {
    window.matchMedia("(orientation: portrait)").onchange = function(){ re(); }
  }
  else
  {
    window.onresize = re;
  }
  
  function re()
  {
    var w = window.innerWidth, h = window.innerHeight;
      
    if( mobile )
    {
      w = screen.width; h = screen.height;
      if(window.matchMedia("(orientation: landscape)").matches && h > w )
      { var t = w; w = h; h = t; }
    }

    if( vertical != h < w ) { rotateSC(h < w); }
    
    //Update and validate all UI components
    
    else if( loadingDone ) { validate(); }
  }

  //Drag and drop file Support.

  window.addEventListener("dragover",function(e){ (e = e || event).preventDefault(); }, false );
  window.addEventListener("drop",function(e)
  {
    (e = e || event).preventDefault(); if (items = e.dataTransfer.items)
    {
      for( var i = 0; i < items.length; i++ )
      {
        if (items[i].kind === "file") { load(items[i].getAsFile()); i = items.length; }
      }
    }
  }, false );
  
  //Transfers the loaded file to the file input.
  
  function load( f ) { var d = new DataTransfer(); d.items.add(f); document.getElementById("file").files = d.files; Open( f ); }
  
  //When opening an file.
  
  function Open( f )
  {
    loadingDone = false; file.setTarget( f ); offset.hide(false);
    
    //Initialize the file buffer.
    
    file.seek(0); file.setBuf( offset.getRows() << 4, onload );
  }
  
  function onload()
  {
    //Always reset the virtual address space when loading a new file.

    file.resetV();

    //The default controls that are enabled on loading a file.

    show("c1"); show("c2"); show("c3"); show("c4");
    
    offset.sel = offset.sele = 0;
    
    offset.adjSize(); offset.update(file);
    
    ds.hide(false);

    //Check format signature type.

    for( var i = 0, c = true; i < signature.length; i++ )
    {
      c = true; for( var b = 0; b < signature[i].length; b++ ){ if( signature[i][b] != file.data[b] ){ c = false; } }

      //Java class files have the same signature.

      if( c && (i != 4 || ((file.data[4] << 24) | (file.data[5] << 16) | (file.data[6] << 8) | file.data[7]) < 45) )
      {
        loadFormat( decodeAPP[i] ); return;
      }
    }

    //For now it is easy to test the x86 disassembler with a MS-DOS com file.

    var ex = file.name.substring(file.name.lastIndexOf("."), file.name.length).toLowerCase();

    for( var i = 0; i < extensions.length; i++ ) { if( ex == extensions[i] ) { loadFormat(decodeAppEX[i]); return; } }

    //No matching format then load the beta testing plugin.

    loadFormat("Format/test.js");
  }

  //Format loader.

  function loadFormat(url)
  {
    //If we already have the format loaded there is no need to reload the script.

    if( Format.src != url )
    {
      Format.parentElement.removeChild(Format); Format = document.createElement("script"); Format.src = url;
      Format.onerror = fmtErr; Format.onload = function(){ format.load(); loadingDone = true; if(r1.display=="none") { formatLoad = !formatLoad; rotateSC(vertical); } }; document.head.appendChild(Format);
    }

    //Else we just call the load operation over again.

    else { try{ format.load(); loadingDone = true; if(r1.display=="none") { formatLoad = !formatLoad; rotateSC(vertical); } } catch(e) { fmtErr(); } document.head.appendChild(Format); }
  }

  //core loader.

  function loadCore(url)
  {
    //If we already have the core loaded there is no need to reload the script.

    if( coreType.src != url )
    {
      coreType.parentElement.removeChild(coreType); coreType = document.createElement("script"); coreType.src = url;
      coreType.onerror = coreErr; document.head.appendChild(coreType);
    }
  }

  //Error message if there is a problem loading the format reader.

  function fmtErr() { loadingDone = true; if(r1.display!="none"){ formatLoad = !formatLoad; rotateSC(vertical); } alert("Unable to load format reader for this file format!"); }

  //Error message if there is a problem loading the processor core type.

  function coreErr() { alert("Unable to load processor core type for disassembling this binary application!"); }
  
  //Hex editor show and hide.
  
  function showH(v)
  {
    var s = 0; if( v ) { virtual.hide(s=virtual.visible); } else { offset.hide(s=offset.visible); }
    
    document.getElementById(v ? "c3" : "c2").value = (s ? "Show " : "Hide ") + (v ? "Virtual" : "Offset");
    
    adjRatio();
  }
  
  function showD()
  {
    ds.hide(ds.visible);
    
    document.getElementById("c4").value = (ds.visible ? "Hide " : "Show ") + "data types";
    
    adjRatio();
  }

  //Experimental.

  function rotateSC(set)
  {
    if( !formatLoad ) { r1.display = "none"; } if( vertical = set )
    {
      //Clear horizontal transform.

      r.display = ""; ds.resetDims(); Tree.resetDims(); dModel.resetDims(); info.style.minHeight = "";

      //Do vertical transform adjustments.

      if( formatLoad )
      {
        r1.display = "flex"; Tree.minWidth( dModel.minWidth( offset.minWidth() ) ); info.style.minWidth = ds.minWidth();
      }
      r2.display = "flex";
    
      offset.minHeight(virtual.minHeight(ds.minHeight()));
    }
    else
    {
      //Clear vertical transform.

      if( formatLoad ) { r1.display = ""; } r2.display = "";
      
      offset.resetDims(); virtual.resetDims(); ds.resetDims(); Tree.resetDims(); dModel.resetDims(); info.style.minWidth = "";

      //Do horizontal transform adjustments.

      r.display = "flex";
      
      if( formatLoad ) { Tree.minHeight( dModel.minHeight( offset.minHeight() ) ); info.style.minHeight = ds.minHeight(); }
      
      ds.minWidth(offset.minWidth());
    }
    
    adjRatio();
  }
  
  //Adjust screen percentage ratio.
  
  function adjRatio()
  {
    var r = 100 / (offset.visible + virtual.visible + ds.visible);
    
    if( vertical )
    {
      offset.height(virtual.height(Tree.height(dModel.height(info.style.height = r1.width = r2.width = "100%")))); ds.height("0%");
      
      ds.width(Tree.width(dModel.width(info.style.width = "33.333333336%")));
      
      if( isFinite(r) ) { r1.height = r2.height = formatLoad ? "50%" : "100%"; offset.width( virtual.width(r+"%")); } else { r1.height = "100%"; r2.height = "0%"; }
    }
    else
    {
      offset.width(virtual.width(ds.width(Tree.width(dModel.width(info.style.width = r1.height = r2.height = "100%")))));
      
      Tree.height(dModel.height(info.style.height = "33.333333336%"));
      
      if( isFinite(r) ) { r1.width = r2.width = formatLoad ? "50%" : "100%"; offset.height(virtual.height(ds.height(r+"%"))); } else { r1.width = "100%"; r2.width = "0%"; }
    }

    //Update and validate all UI components
    
    if( loadingDone ) { validate(); }
  }
  
  //Show hidden elements.
  
  function show( el )
  {
    document.getElementById(el).style.display = "";
  }
</script>
<input type="file" id="file" onchange="Open(this.files[0]);" /><input type="button" id="c1" value="Hide text" onclick="if(offset.text){offset.setText(false);virtual.setText(false);this.value='Show text';}else{offset.setText(true);virtual.setText(true);this.value='Hide text';};rotateSC(vertical);" style="display:none;" /><input type="button" id="c2" value="Hide Offset" onclick="showH(false);" style="display:none;" /><input type="button" id="c3" value="Show Virtual" onclick="showH(true);" style="display:none;" />
<input type="button" id="c4" value="Hide Data Types" onclick="showD();" style="display:none;" />
<div id="r" style="height:100%;width:100%;">
  <div style="display:none;" id="r1"><div id="tree"></div><div id="dModel"></div><div id="info"></div></div>
  <div id="r2"><div id="vhex1"></div><div id="vhex2"></div><div id="data"></div></div>
</div>
</body>
</html>