<html>
  <head>
    <title>JD-asm</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="JD-asm">
    <link rel="apple-touch-icon" href="https://recoskie.github.io/JDasm/icon.png">
    <meta property="og:image" content="https://repository-images.githubusercontent.com/24021024/5e678080-0cfe-11eb-9edf-294da025f0c1" />
    <link rel="canonical" href="https://recoskie.github.io/JDasm/" />
    <link rel="manifest" href="manifest.json">
    <style>
      #r1 div, #r2 div { border-style:solid; border-color:black; border-width:2px; }
      /***********************************************************************************
      Create a menubar for application.
      ***********************************************************************************/
      .toolBtn { white-space: nowrap; padding: 8px; border: none; cursor: pointer; }
      .toolBar { position: relative; display: inline-block; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
      .toolBarI { display: none; position: absolute; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; }
      .toolBarI a { color: black; padding: 12px 16px; text-decoration: none; display: block; cursor: pointer; }
      .toolBarI a:hover {background-color: #f1f1f1}
      .toolBar:hover .toolBarI { display: block; }
      .toolBar:hover .toolBtn { box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); }
    </style>
    <script type="text/javascript" src="swingIO/UI.js"></script>
    <script type="text/javascript" src="RandomAccessFileV/FileReaderV.js"></script>
    <script type="text/javascript" id="Format"></script>
    <script type="text/javascript" id="coreType"></script>
    <script>
      /*------------------------------------------------------------
      This is a web based version of JDasm originally designed to run in Java.
      See https://github.com/Recoskie/JDasm/blob/master/app.java
      ------------------------------------------------------------*/
      
      var file = new FileReaderV(), r = null, r1 = null, r2 = null;
      var Tree = null, dModel = null, info = null;
      var offset = null, virtual = null, ds = null;
      
      //The currently loaded format reader.
      
      var Format = null;
      
      //Used for loading in processor core types.
      
      var coreType = null;
      
      //Enable binary tree and data model, and info window for file format readers.
      
      var formatLoad = false;
      
      //Use the file signature codes instead of file extension.
      
      var signature =
      [
        [ 0x4D, 0x5A ], //Microsoft binaries.
        [ 0x7F, 0x45, 0x4C, 0x46 ], //Linux/UNIX binaries.
        [ 0xCE, 0xFA, 0xED, 0xFE ], //32 Bit Mac/IOS binary.
        [ 0xCF, 0xFA, 0xED, 0xFE ], //64 Bit Mac/IOS binary.
        [ 0xCA, 0xFE, 0xBA, 0xBE ], //Mac/IOS universal binary.
        /*[ 0xCA, 0xFE, 0xBA, 0xBE ],*/ //Reserved for java class loader format plugin.
        [ 0x42, 0x4D ], //Bit map pictures.
        [ 0xFF, 0xD8 ], //JPEG start of image marker.
        [ 0x52, 0x49, 0x46, 0x46 ], //Multimedia RIFF file.
        [ 0x52, 0x46, 0x36, 0x34 ], //Multimedia RIFF/64 file.
        [ 0x50, 0x4B, 0x03, 0x04 ], //Compressed ZIP files.
        [ 0x50, 0x4B, 0x07, 0x08 ], //Compressed ZIP files (split).
        [ 0x50, 0x4B, 0x05, 0x06 ] //Compressed ZIP files (Empty).
      ];
      
      //The file to load. To begin decoding file types.
      
      var decodeAPP =
      [
        "Format/exe.js", "Format/elf.js", "Format/mac.js", "Format/mac.js", "Format/mac.js", /*"Format/java.js",*/
        "Format/bmp.js", "Format/jpeg.js", "Format/riff.js", "Format/riff.js",
        "Format/zip.js", "Format/zip.js", "Format/zip.js"
      ];
      
      //Format to load that only use file extension for file type.
      
      var extensions = [".com"];
      
      //What file to load for file extension.
      
      var decodeAppEX = ["Format/com.js"];
      
      //Initialize the application.
      
      function init()
      {
        r = document.getElementById("r").style; r1 = document.getElementById("r1").style; r2 = document.getElementById("r2").style;
      
        offset = new VHex("vhex1", file, false); virtual = new VHex("vhex2", file, true);
        ds = new dataInspector("data", file); ds.addEditor(offset); ds.addEditor(virtual);
      
        Tree = new tree("tree"); dModel = new dataDescriptor("dModel", file); dModel.setInspector(ds); info = document.getElementById("info");
      
        info.style.overflow = "auto"; info.innerHTML = "File format Information is displayed here, and machine code disassembly.";
        
        virtual.adjSize(); virtual.hide(true); re(); offset.hide(true); ds.hide(true);
      
        Format = document.getElementById("Format"); coreType = document.getElementById("coreType");
        
        //Open an example file.
        
        file.getFile("https://raw.githubusercontent.com/Recoskie/JDasm/master/JD-asm.jar", Open);
      }
      
      //Layout change based on window dimensions, or orientation.
        
      var vertical = null, mobile = !isNaN( window.orientation );
      
      if( mobile )
      {
        window.matchMedia("(orientation: portrait)").onchange = function(){ re(); }
      }
      else
      {
        window.onresize = re;
      }
      
      function re()
      {
        var w = window.innerWidth, h = window.innerHeight;
          
        if( mobile )
        {
          w = screen.width; h = screen.height;
          if(window.matchMedia("(orientation: landscape)").matches && h > w )
          { var t = w; w = h; h = t; }
        }
      
        if( vertical != h < w ) { rotateSC(h < w); }
        
        //Update and validate all UI components.
        
        resize();
      }
      
      //Drag and drop file Support.
      
      var dragItem = null, setItem = null; window.addEventListener("dragover",function(e){ (e = e || event).preventDefault(); }, false );
      window.addEventListener("drop",function(e)
      {
        (e = e || event).preventDefault(); if (items = e.dataTransfer.items)
        {
          for( var i = 0; i < items.length; i++ )
          {
            if (items[i].kind === "file") { Open(items[i].getAsFile()); return; }
          }
        }
      }, false );

      //Open a file from a web address.

      function webFile()
      {
        var url = prompt("Enter the address to the web page or file.", "https://");

        if (url != null || url != "") { file.getFile(url, Open); }
      }
      file.getError = function()
      {
        alert("<h1>Network error occurred</h1>This could be a CORS issue, a dropped internet connection, or the page does not exist. It is not possible for us to know.\
        <h1>CORS Error</h1>The CORS policy is a security feature that limits what can be read on the internet from web addresses.<br /><br />\
        The following <a href='https://simplelocalize.io/blog/posts/what-is-cors/#3-disable-browser-cors-checks' target='_blank'>link</a> explains what the CORS policy is.<br /><br />\
        JDasm can read and analyze files from other web addresses if the server is configured to allow it.<br /><br />\
        You can disable the CORS check if you really want to analyze a file from a web address without downloading the file.");
      }

      //Transfers the loaded file to the file input.
      
      function Open( f )
      {
        dragItem = f; file.setTarget( f ); offset.hide(false);
        
        //Initialize the file buffer.
        
        file.bufRead(this, "onload"); file.seek(0); file.read(file.buf);
      }
      
      function onload()
      {
        //The only way onload gets called is if the file is readable.
      
        document.getElementById("setFile").innerHTML = "Current file: " + dragItem.name; setItem = dragItem; //Update the file that is opened.
      
        //Always reset the virtual address space when loading a new file.
      
        file.resetV();
        
        offset.sel = offset.sele = 0;
        
        offset.adjSize(); offset.update(file);
        
        ds.hide(false);
      
        //Check format signature type.
      
        for( var i = 0, c = true; i < signature.length; i++ )
        {
          c = true; for( var b = 0; b < signature[i].length; b++ ){ if( signature[i][b] != file.data[b] ){ c = false; } }
      
          //Java class files have the same signature.
      
          if( c && (i != 4 || ((file.data[4] << 24) | (file.data[5] << 16) | (file.data[6] << 8) | file.data[7]) < 45) )
          {
            loadFormat( decodeAPP[i] ); return;
          }
        }

        //We can not properly identify the file extension if it is a domain name with no file path separators.

        var ex = file.name.indexOf("//",0)+2; if( ex == 1 || (ex > 1 && file.name.indexOf("/",ex) > 0) )
        {
          //Some file formats can only be identified by file extension as there is no unique signature at the start of the files data.
      
          ex = file.name.substring(file.name.lastIndexOf("."), file.name.length).toLowerCase();
      
          for( var i = 0; i < extensions.length; i++ ) { if( ex == extensions[i] ) { loadFormat(decodeAppEX[i]); return; } }
        }
      
        formatLoad = false; rotateSC(vertical);
      }
      
      //Format loader.
      
      function loadFormat(url)
      {
        //If we already have the format loaded there is no need to reload the script.
      
        if( Format.src != url )
        {
          Format.parentElement.removeChild(Format); Format = document.createElement("script"); Format.src = url;
          Format.onerror = fmtErr; Format.onload = function(){ format.load(); if(r1.display=="none") { formatLoad = !formatLoad; rotateSC(vertical); } }; document.head.appendChild(Format);
        }
      
        //Else we just call the load operation over again.
      
        else { try{ format.load(); if(r1.display=="none") { formatLoad = !formatLoad; rotateSC(vertical); } } catch(e) { fmtErr(); } document.head.appendChild(Format); }
      }
      
      //core loader.
      
      function loadCore(url)
      {
        //If we already have the core loaded there is no need to reload the script.
      
        if( coreType.src != url )
        {
          coreType.parentElement.removeChild(coreType); coreType = document.createElement("script"); coreType.src = url;
          coreType.onerror = coreErr; document.head.appendChild(coreType);
        }
      }
      
      //Error message if there is a problem loading the format reader.
      
      function fmtErr() { if(r1.display!="none"){ formatLoad = !formatLoad; rotateSC(vertical); } alert("Unable to load format reader for this file format!"); }
      
      //Error message if there is a problem loading the processor core type.
      
      function coreErr() { alert("Unable to load processor core type for disassembling this binary application!"); }
      
      //Hex editor show and hide.
      
      function showH(v)
      {
        var s = 0; if( v ) { virtual.hide(s=virtual.visible); } else { offset.hide(s=offset.visible); }
        
        document.getElementById(v ? "i2" : "i1").innerHTML = (s ? "Show " : "Hide ") + (v ? "Virtual" : "Offset");
        
        resize();
      }
      
      function showD()
      {
        ds.hide(ds.visible);
        
        document.getElementById("i3").innerHTML = (ds.visible ? "Hide " : "Show ") + "data types";
        
        resize();
      }
      
      //Experimental.
      
      function rotateSC(set)
      {
        if( !formatLoad ) { r1.display = "none"; } if( vertical = set )
        {
          //Clear horizontal transform.
      
          r.display = "";
      
          //Do vertical transform adjustments.
      
          if( formatLoad )
          {
            r1.display = "flex";
          }
          r2.display = "flex";
        }
        else
        {
          //Clear vertical transform.
      
          if( formatLoad ) { r1.display = ""; } r2.display = "";
      
          //Do horizontal transform adjustments.
      
          r.display = "flex";
        }
      
        resize();
      }
      
      //Redesign the layout. Work in progress.
      
      function resize()
      {
        //Reset everything. Note it is best to not simplify or refactor this function until a final layout is decided.
      
        offset.resetDims(); virtual.resetDims(); ds.resetDims(); Tree.resetDims(); dModel.resetDims();
        info.style.minWidth = info.style.minHeight = r1.minWidth = r1.maxWidth = r2.minWidth = r2.maxWidth = "";
        
        var re = (window.innerHeight - parseInt(document.getElementById("r").offsetTop))-16;
        
        document.getElementById("r").style.height = re + "px";
        
        if( vertical )
        {
          r1.minHeight = dModel.minHeight(); r1.width = r2.width = "100%";
      
          //Number of visible hex editors.
          
          var h = (offset.visible + virtual.visible) & -1;
          
          //The components in r2 have minium fixed width sizes that should match in r1.
          
          Tree.minWidth(offset.minWidth()); dModel.minWidth(virtual.minWidth()); info.style.minWidth=ds.minWidth();
          
          //When viewing everything sideways r2 is min size for data components.
          //The row r1 is the remaining height available.
        
          var minHeight = Math.max(ds.visible ? ds.minHeight().pxValue() : 0,h != 0 ? offset.minHeight().pxValue() : 0);
          
          offset.height(virtual.height(r2.height = r2.minHeight = minHeight));
          
          r1.height = (re - minHeight) + "px";
      
          //The last component is 100% width in both rows.
      
          ds.width(info.style.width = "100%");
        }
      
        //Straight up and down three components to the left in r1 (Tree view, data model, information panel) to the right r2 (offset, virtual, data type inspector).
      
        else
        {
          //When viewing up and down both rows are 100% height.
      
          r1.height = r2.height = "100%";
      
          //The components in r1 can take any min height, but the components in r2 have minium fixed height sizes.
          
          Tree.minHeight(offset.minHeight()); dModel.minHeight(virtual.minHeight()); info.style.height=ds.height(ds.minHeight());
      
          //The min/max width of the last row should be the min width of the hex editors.
          //The first row can not be smaller than the data model min width.
          
          r1.minWidth = dModel.minWidth(); r1.width = "100%"; r2.width = r2.minWidth = ds.minWidth(offset.minWidth());
      
          //Number of visible hex editors.
          
          var h = (offset.visible + virtual.visible) & -1;
      
          //divide area up regularly for r1.
          
          var heightEnd = ds.minHeight().pxValue(), share = (re - heightEnd) / 2;
          
          //If there is no loaded format than rwo one does not exist.
          
          if( !formatLoad ) { r1.minWidth = r1.width = "0px"; r2.width = "100%"; }
          else
          {
            Tree.height(dModel.height(share+"px"));
          }
          
          //Add +4 pixels for each invisible component because of 2px border.
          
          if( h == 2 ) { h = 1; } else if( h == 1 ) { re += 4; h = 2; }
          
          //If there is no visible hex editors then the data inspector can be set full height
        
          else { re += 8; if( ds.visible ) { ds.height(re +"px"); } else { r2.minWidth = r2.width = "0px"; } }
          
          if( !ds.visible ) { share = re / 2; } else { share = (re - heightEnd) / 2; }
          
          offset.height(virtual.height((share*h)+"px"));
        }
        
        offset.validate(); virtual.validate(); dModel.validate();
      }
      
      //Show hidden elements.
      
      function show( el )
      {
        document.getElementById(el).style.display = "";
      }
      
      //When a file fails to load.
      
      file.onerror = function()
      {
        //When the open file is the same as the loaded and set file, then user may have move, renamed, deleted the file on their disk drive.
      
        if( dragItem == setItem ) { alert("The file you are reading from your disk drive may have been deleted!"); return; }
        
        alert("Folders can not be read as files.<br /><br />Note if you are on macOS, applications are stored in folders.<br />To open the application's files right click, then hit show package contents.");

        dragItem = setItem; file.setTarget( setItem );
      }
      
      String.prototype.pxValue = function() { return(parseInt(this.replace("px",""))); }
      
      //Add the web application service worker. Keep service worker disabled for now while doing lots of changes and updates.
      
      if(navigator.serviceWorker) { navigator.serviceWorker.register('/JDasm/sw.js', {scope: '/JDasm/'} ) }
    </script>
  </head>
  <body onload="init();">
    <div style="width:100%;background-color:#E0E0E0;">
      <input type="file" id="file" onchange="Open((dragItem = this.files)[0]);" hidden>
      <div class="toolBar">
        <button id="toolBar" class="toolBtn">File</button>
        <div class="toolBarI">
          <a onclick="document.getElementById('file').click();">Open file on device.</a>
          <a onclick="webFile();">Open file from web address.</a>
        </div>
      </div>
      <div style="display: inline-block;" class="toolBar">
        <button id="toolBar" class="toolBtn">View</button>
        <div class="toolBarI">
          <a onclick="if(offset.text){offset.setText(false);virtual.setText(false);this.innerHTML='Show text';}else{offset.setText(true);virtual.setText(true);this.innerHTML='Hide text';};rotateSC(vertical);">Hide text</a>
          <a onclick="showH(false);" id="i1">Hide Offset</a>
          <a onclick="showH(true);" id="i2">Show Virtual</a>
          <a onclick="showD();" id="i3">Hide Data Types</a>
        </div>
      </div>
      <div style="display: inline-block;" id="setFile"></div>
    </div>
    <div id="r" style="height:100%;width:100%;">
      <div style="display:none;" id="r1">
        <div id="tree"></div>
        <div id="dModel"></div>
        <div id="info"></div>
      </div>
      <div id="r2">
        <div id="vhex1"></div>
        <div id="vhex2"></div>
        <div id="data"></div>
      </div>
    </div>
  </body>
</html>